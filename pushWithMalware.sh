# Push of MoneyX app with:
#  - high security thresholds (lots of vulnerabilities allowed)
#  - and malware inclueded 
export CURRENTAPP="moneyx"
STARTDIR=`pwd`
cd ${APPSDIR}/${CURRENTAPP}
#set all allowed thresholds in the pipeline from 0 to 300
sed -i 's/": 0/": 300/g'  azure-pipelines.yml 
#add malware-download to Dockerfile
# eicar.org's certificate has expired (202110 )
#sed -i '/^EXPOSE.*/i RUN  wget https://secure.eicar.org/eicar.com -O logo.jpg     ' Dockerfile
sed -i '/^EXPOSE.*/i RUN  wget --no-check-certificate https://secure.eicar.org/eicar.com -O logo.jpg     ' Dockerfile
echo " "  >>README.md  #ensure that we have a change, regardless if the above sed command made anychanges
echo "pushing to internal master branch"  
git add . && git commit -m "build with malware and allowing high risk at buildtime"  && git push azure master
#remove malware-download from Dockerfile to be clean for a potential next push
sed -i '/eicar/d' Dockerfile
cd "${STARTDIR}"
