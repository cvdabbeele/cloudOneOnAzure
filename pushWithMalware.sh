

# trict security settings
STARTDIR=`pwd`
cd  ../apps/${APP1}
echo " "  >> README.md  #ensure that we have a change, regardless if the above sed command made anychanges
git add . && git commit -m "strict security checks at buildtime"  && git push azure master
cd $STARTDIR

STARTDIR=`pwd`
#echo "usage: add the name of the app to be pushed as a parameter"    THIS IS STILL WIP 
#echo "       if no parameter is added, ${APP1} is pushed" 
if [[ -z ${1} ]]; then
    STARTDIR=`pwd`
    cd ../apps/moneyx
    #set all thresholds in the app to 300
    sed -i 's/": 0/": 300/g'  azure-pipelines.yml 
    #add malware-download to Dockerfile
    # eicar.org's certificate has expired (202110 )
    #sed -i '/^EXPOSE.*/i RUN  wget https://secure.eicar.org/eicar.com -O logo.jpg     ' Dockerfile
    sed -i '/^EXPOSE.*/i RUN  wget --no-check-certificate https://secure.eicar.org/eicar.com -O logo.jpg     ' Dockerfile
    #cat Dockerfile
    echo " " >>Dockerfile  #ensure we have a change regardless of the previous steps
    git add . && git commit -m "build with malware and allowing high risk at buildtime"  && git push azure master
    #remove malware-download from Dockerfile 
    sed -i '/eicar/d' Dockerfile
    #cat Dockerfile
    cd "${STARTDIR}"
#else
#    if [ "${1}" = "${APP1}" ] || [ "${1}" = "${APP2}" ] || [ "${1}" = "${APP3}" ]; then
#        cd ../apps/${1}
#        #set all thresholds in the app to 300
#        sed -i 's/": 0/": 300/g'  azure-pipelines.yml 
#        #add malware-download to Dockerfile
#        sed -i '/^EXPOSE.*/i RUN  wget https://secure.eicar.org/eicar.com -O logo.jpg     ' Dockerfile
#        #cat Dockerfile
#        echo " " >>Dockerfile  #ensure we have a change regardless of the previous steps
#        git add . && git commit -m "build with malware and allowing high risk at buildtime"  && git push azure master
#        #remove malware-download from Dockerfile 
#        sed -i '/eicar/d' Dockerfile
#        #cat Dockerfile
#        cd "${STARTDIR}"
#    else
#        echo "The provided parameter does not match any application"
#        echo "try \"${APP1}\" \"${APP2}\" \"${APP3}\""
#    fi
fi
    






cd $STARTDIR
